<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia at Jan 17, 2014
 | Rendered using Apache Maven Fluido Skin 1.3.0
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="author" content="Peter Mucha" />
    <meta name="Date-Revision-yyyymmdd" content="20140117" />
    <meta http-equiv="Content-Language" content="en" />
    <title>
		Exmo</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.3.0.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />

      
    <script type="text/javascript" src="./js/apache-maven-fluido-1.3.0.min.js"></script>

                          
        
<script type="text/javascript">$(document).ready(function(){
						
			$(".java-xml-src").wrap("<div class='tabbable tabs-left' />")
			$(".java-xml-src").before(function(){
				var id = $(this).attr('id');
				return "<ul class='nav nav-tabs'>" +
				"<li class='active'><a data-toggle='tab' href='#java-"+id+"'>Java</a></li>"+
				"<li><a data-toggle='tab' href='#xml-"+id+"'>XML</a></li></ul>"
			})
			
			$(".java-xml-src").addClass("tab-content")
			$(".java-xml-src > div:nth-child(1)").wrap(function(){
				var id = $(this).parent().attr("id");
				return "<div id='java-"+id+"' class='tab-pane fade active in'>";
			})
			$(".java-xml-src > div:nth-child(2)").wrap(function(){
				var id = $(this).parent().attr("id");
				return "<div id='xml-"+id+"' class='tab-pane fade'>";
			})
			
			
		});</script>
                      
        
<style type="text/css">#banner {display:none}
  #breadcrumbs {display:none}</style>
          
    <!-- <meta ... /> -->        </head>
        <body class="topBarEnabled">
          
                
                    
                

    <div id="topbar" class="navbar navbar-fixed-top ">
      <div class="navbar-inner">
                <div class="container-fluid">
        <a data-target=".nav-collapse" data-toggle="collapse" class="btn btn-navbar">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </a>
                
                                <ul class="nav">
                          <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Utils <b class="caret"></b></a>
        <ul class="dropdown-menu">
        
                      <li>      <a href="index.html"  title="Introduction">Introduction</a>
</li>
                  
                      <li>      <a href="usage.html"  title="Usage">Usage</a>
</li>
                  
                      <li>      <a href="faq.html"  title="FAQ">FAQ</a>
</li>
                          </ul>
      </li>
                <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Parent <b class="caret"></b></a>
        <ul class="dropdown-menu">
        
                      <li>      <a href="../staging/index.html"  title="Parent">Parent</a>
</li>
                          </ul>
      </li>
                <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Project Documentation <b class="caret"></b></a>
        <ul class="dropdown-menu">
        
                      <li class="dropdown-submenu">
                                      <a href="project-info.html"  title="Project Information">Project Information</a>
              <ul class="dropdown-menu">
                                  <li>      <a href="plugins.html"  title="Project Plugins">Project Plugins</a>
</li>
                              </ul>
            </li>
                  
                      <li class="dropdown-submenu">
                                      <a href="project-reports.html"  title="Project Reports">Project Reports</a>
              <ul class="dropdown-menu">
                                  <li>      <a href="apidocs/index.html"  title="JavaDocs">JavaDocs</a>
</li>
                                  <li>      <a href="testapidocs/index.html"  title="Test JavaDocs">Test JavaDocs</a>
</li>
                              </ul>
            </li>
                          </ul>
      </li>
                  </ul>
          
          
          
                   
                      </div>
          
        </div>
      </div>
    </div>
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                <div id="bannerLeft">
                <h2>Exmo</h2>
                </div>
                      </div>
        <div class="pull-right">  </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
                
                    
            
                
                    
      
                            </ul>
      </div>

            
      <div class="row-fluid">
        <div id="leftColumn" class="span3">
          <div class="well sidebar-nav">
                
                    
                <ul class="nav nav-list">
                    <li class="nav-header">Utils</li>
                                
      <li>
    
                          <a href="index.html" title="Introduction">
          <i class="none"></i>
        Introduction</a>
            </li>
                  
      <li class="active">
    
            <a href="#"><i class="none"></i>Usage</a>
          </li>
                  
      <li>
    
                          <a href="faq.html" title="FAQ">
          <i class="none"></i>
        FAQ</a>
            </li>
                              <li class="nav-header">Parent</li>
                                
      <li>
    
                          <a href="../staging/index.html" title="Parent">
          <i class="none"></i>
        Parent</a>
            </li>
                              <li class="nav-header">Project Documentation</li>
                                                                                  
      <li>
    
                          <a href="project-info.html" title="Project Information">
          <i class="icon-chevron-right"></i>
        Project Information</a>
                  </li>
                                                                                      
      <li>
    
                          <a href="project-reports.html" title="Project Reports">
          <i class="icon-chevron-right"></i>
        Project Reports</a>
                  </li>
            </ul>
                
                    
                
          <hr class="divider" />

           <div id="poweredBy">
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" />
      </a>
                  </div>
          </div>
        </div>
        
                
        <div id="bodyColumn"  class="span9" >
                                  
            

	

		<div class="section"><h2>Java-based Mappings<a name="Java-based_Mappings"></a></h2>
		<p>The fluent java dsl is defined in the <a href="apidocs/wrm/exmo/utils/transform/RuleBuilder.html">RuleBuilder</a>
		 interface that defines the syntax of one mapping entry as well as the 
		 <a href="apidocs/wrm/exmo/utils/transform/RuleBuilder.html">RuleBuilderBase</a> which defines additional helper methods.</p>
		 <p>
		 Every new Mapper inherits from <a href="apidocs/wrm/exmo/utils/transform/FluentMapper.html">FluentMapper</a> and can define new rules 
		 either in the constructor or in the method <tt>createRules()</tt> which will be called in the beginning of a mapping.
		 </p>
		
		</div>
		
		<div class="section"><h2>Xml-based Mappings<a name="Xml-based_Mappings"></a></h2>
		<p>In xml-based mapping-definitions, the possibilities are more limited. Basically, you can define all behavior in <tt>&lt;script&gt;-tags</tt> (currently, javascript is used as interpreted language).<br />
		Every transformation defines its own script-context so no sharing between transformation-files is possible at runtime. Though code can be shared. More information on how to include code-files in the <a href="faq.html">FAQ</a>.
		</p>
		<p>
		<span class="label label-info">Remark:</span> Every <tt>&lt;script&gt;-tag</tt> will be executed in the beginning of a mapping (Similar to embedded javascript in an html page). 
		So this is where you can initialize caches etc, but because it is only executed ONCE per transformator and they are reused, it is better to add a <tt>factoryExpr</tt> and initialize there.
		</p>
		</div>


		<!-- The body of the document contains a number of sections -->
		<div class="section"><h2>Selection<a name="Selection"></a></h2>
			To select a value for the transformation, <a href="apidocs/wrm/exmo/utils/transform/selector/Selector.html">Selectors</a> are used.
			Different Selectors already exist.
			<ul>
			<li><a href="apidocs/wrm/exmo/utils/transform/selector/PropertySelector.html">Property Selector</a>: This selector uses <a class="externalLink" href="http://commons.apache.org/beanutils/">BeanUtils</a> to retrieve values from java beans. More information on how to selected (nested) properties are available <a class="externalLink" href="http://commons.apache.org/beanutils/apidocs/org/apache/commons/beanutils/package-summary.html#standard.basic">here</a>.
			<div id="1" class="java-xml-src">
				<div class="source"><pre class="prettyprint linenums">map(&quot;nested.property.method(argument).property&quot;).to(&quot;target.property&quot;);</pre></div>
				<div class="source"><pre class="prettyprint linenums">&lt;mapping from=&quot;nested.property.method(argument).property&quot; to=&quot;target.property&quot; /&gt;</pre></div>
			</div>
			</li>

			<li><a href="apidocs/wrm/exmo/utils/transform/selector/ScriptSelector.html">Script Selector</a>: This value executes the given script and returns the result as selected value.
			<div id="2" class="java-xml-src">
				<div class="source"><pre class="prettyprint linenums">map(expr(&quot;source.parent.method()&quot;)).to(&quot;target.property&quot;);</pre></div>
				<div class="source"><pre class="prettyprint linenums">&lt;mapping expr=&quot;source.parent.method()&quot; to=&quot;target.property&quot; /&gt;</pre></div>
			</div>
			</li>
			
			<li><a href="apidocs/wrm/exmo/utils/transform/selector/ValueSelector.html">Value Selector</a>: This selector just returns the value that was given to it. This can be used to map static attributes.
			<div id="3" class="java-xml-src">
				<div><div class="source"><pre class="prettyprint linenums">map(value(&quot;STATIC&quot;)).to(&quot;target.property&quot;);</pre></div>
					You can access registered environment variables here, e.g. <tt>map(value(&quot;${MyVariable}&quot;))</tt>
				</div>
				<div><div class="source"><pre class="prettyprint linenums">&lt;mapping expr=&quot;'STATIC'&quot; to=&quot;target.property&quot; /&gt;</pre></div>
					The <b>Script</b> selector is used for static values in xml instead of the Value Selector. Most often, simple strings are returned.
				</div>
			</div>
			</li>
			
			<li><a href="apidocs/wrm/exmo/utils/transform/selector/DefaultSelector.html">Default Selector</a>: This selector is kind of a meta-selector which accepts two selectors. 
			If the first selector returns null, the value of the second will be returned instead. There are convenience-methods available to create this selector:  
			<div id="7" class="java-xml-src">
				<div class="source"><pre class="prettyprint linenums">map(&quot;property&quot;).to(&quot;target.property&quot;).onNull(value(&quot;STATIC&quot;));</pre></div>
				<div><div class="source"><pre class="prettyprint linenums">&lt;mapping expr=&quot;property&quot; to=&quot;target.property&quot; onNull=&quot;'STATIC'&quot; /&gt;</pre></div>
					Here, a ScriptSelector will be created as default-selector.
				</div>
			</div>
			</li>
			
			
			</ul>
			
			
			These selectors are extensible and custom versions can be implemented. This can be done as follows:
			<div id="4" class="java-xml-src"><div>
			For the java-based usage, every mapper can define new selectors that implements the Selector-interface. It is good practice to wrap these selectors in helper-methods to fit the fluent interface, e.g.
			<div class="source"><pre class="prettyprint linenums">
public Selector lookup(String name){
	return new LookUpSelector(name);
}

//this allows better usage in defining the mappings:
map(lookup(&quot;X&quot;)).to(&quot;property&quot;);</pre></div></div>
			<div>
			In Xml, this will be done by defining a lookup-method that will be called
			<div class="source"><pre class="prettyprint linenums">
&lt;script&gt;
function lookup(name){
//... implementation of lookup
}
&lt;/script&gt;

&lt;mapping expr=&quot;lookup('X')&quot; to=&quot;property&quot; /&gt;</pre></div>
	</div>		
		</div>	
		
		
		</div>






		<div class="section"><h2>Conversion<a name="Conversion"></a></h2>
		For every mapping, simple conversion will be done by default usign the <a class="externalLink" href="http://commons.apache.org/beanutils/api/org/apache/commons/beanutils/ConvertUtilsBean.html">ConvertUtils</a>. 
		Everything else will be done using Implementations of <a href="apidocs/wrm/exmo/utils/transform/converter/TypeConverter.html">TypeConverters</a>. <br />
		Some simple TypeConverters already exist:
		<ul>
		<li>
		<a href="apidocs/wrm/exmo/utils/transform/converter/ScriptConverter.html">ScriptConverter</a>: executes a given script on the current value and returns the transformed value for further usage.
		<div id="5" class="java-xml-src">
				<div class="source"><pre class="prettyprint linenums">map(&quot;property&quot;).to(&quot;target.property&quot;).with(&quot;value + '_converted'&quot;);</pre></div>
				<div class="source"><pre class="prettyprint linenums">
&lt;mapping from=&quot;property&quot; to=&quot;target.property&quot;&gt;
	&lt;with expr=&quot;value + '_converted' /&gt;
&lt;/mapping&gt;</pre></div>
		</div>
		</li>
		</ul>
		
		<span class="label label-info">Remark:</span> Mappers can be chained together and will be called in the defined sequence.
		
		<div class="section"><h3>Submappers<a name="Submappers"></a></h3>
		<p>
		Most often, simple mapping-definitions with value-based conversion is not enough and you need to 
		define complex sub-mappers. Every mapping-definition is itself a converter. <br />
		That means, FluentMappers can also be used as more complex converter.
		</p>
			<div id="6" class="java-xml-src">
				<div class="source"><pre class="prettyprint linenums">
map(&quot;complexProperty&quot;).to(&quot;target.property&quot;).with( new FluentMapper(){{
	map(&quot;nested.property&quot;).to(&quot;nested.target&quot;);
}});</pre></div>
	<div>Here, <tt>with</tt> defines a new mapper that will be used as converter.<div class="source"><pre class="prettyprint linenums">
&lt;mapping from=&quot;complexProperty&quot; to=&quot;target.property&quot;&gt;
	&lt;with&gt;
		&lt;mapping from=&quot;nested.property&quot; to=&quot;nested.target&quot; /&gt;
	&lt;/with&gt;
&lt;/mapping&gt;</pre></div></div>
		</div>
		</div>
		
		<div class="section"><h3>Mapping of Collections<a name="Mapping_of_Collections"></a></h3>
		<p>
		In case you want to map a whole collection element-wise, you need to define a converter/mapper that is called element-wise. You also need to state the target element type.<br />
		</p>
		<div id="12" class="java-xml-src">
			<div class="source"><pre class="prettyprint linenums">map(&quot;collection&quot;).asElementsOfType(String.class).to(&quot;target.collection&quot;).with(&quot;value + '_converted'&quot;);</pre></div>
			<div class="source"><pre class="prettyprint linenums">&lt;mapping from=&quot;collection&quot; to=&quot;target.collection&quot; elements=&quot;java.lang.String&quot; &gt;
	&lt;with expr=&quot;value + '_converted'&quot; /&gt;			
&lt;/mappings&gt;</pre></div>
		</div>
		<p>You can change the way the initial collection is created by using a <tt>collectionFactoryExpr</tt> in Xml. This will be called instead. <br />
		<span class="label label-info">Remark:</span> It can be used to achieve an <i>additive</i> behavior (i.e. add items to an existing collection instead of creating a new collection).
		</p>
		
		</div>
		<div class="section"><h3>Global Converters<a name="Global_Converters"></a></h3>
		<p>You can register global converters that map from a specific type to another specific type. 
		This can enhance the readability of your mapping rules because you do not have to repeat the declaration of these converters again and again.</p>
		<div id="13" class="java-xml-src">
			<div class="source"><pre class="prettyprint linenums">registerGlobalConverter(new CalendarToDateConverter(),XMLGregorianCalendar.class, Date.class);</pre></div>
			<div class="source"><pre class="prettyprint linenums">not supported in xml</pre></div>
		</div>
		</div>
		</div>




		<div class="section"><h2>Mapping<a name="Mapping"></a></h2>
		<p>The final selection of the target will also be done using <a class="externalLink" href="http://commons.apache.org/beanutils/">BeanUtils</a>. No customization is possible here</p>
		
		</div>


		<div class="section"><h2>Callbacks<a name="Callbacks"></a></h2>
		There are three kind of callbacks that can be used to customize the mapping-process even more.
		<ul>
		<li><b>createTargetObject</b>: This callback can intercept the default behavior of creating a new instance of the target type, e.g. for lookup of cached values.
		<div id="8" class="java-xml-src">
				<div class="source"><pre class="prettyprint linenums">
public class CustomMapper extends FluentMapper&lt;SourceClass, TargetClass&gt;{
  @Override
  protected TargetClass createTargetObject(SourceClass sourceObject, Class&lt;? extends TargetClass&gt; classObject) {
  		return lookupCachedValue(sourceObject);
  }
}
				</pre></div>
				<div class="source"><pre class="prettyprint linenums">
&lt;mappings xmlns=&quot;http://wrm.exmo.transform&quot; factoryExpr=&quot;lookupCachedValue(source)&quot;&gt;
	&lt;!-- mapping definitions --&gt;
  &lt;script&gt;
    function lookupCachedValue(sourceObj){
      //... implementation
    }
  &lt;/script&gt;
&lt;/mappings&gt;

</pre></div>	
			</div>
		</li>
		
		<li><b>postMappingCallback</b>: Will be called after every mapping-definition was processed. This is only available in java-interface.
		<div id="9" class="java-xml-src">
			<div class="source"><pre class="prettyprint linenums">
public class CustomMapper extends FluentMapper&lt;SourceClass, TargetClass&gt;{
  @Override
  protected void postMappingCallback(SourceClass source, TargetClass target)
  		//... do something with source and target
  }
}
				</pre></div>
				<div class="source"><pre class="prettyprint linenums">not available in xml</pre></div>
		</div>
		</li>
		
		<li><b>Mapping-Rule Callback</b>: This is a callback that will be executed after successful processing of one mapping definition.
		<div id="10" class="java-xml-src">
			<div><div class="source"><pre class="prettyprint linenums">map(&quot;property&quot;).to(&quot;target.property&quot;).andDo(&quot;target.id = createId()&quot;);</pre></div>
			Passing a String creates a <a href="apidocs/wrm/exmo/utils/transform/callback/ScriptCallback.html">ScriptCallback</a>. 
			You can pass every implementation of <a href="apidocs/wrm/exmo/utils/transform/callback/RuleCallback.html">RuleCallback</a> instead.
			</div>
			<div class="source"><pre class="prettyprint linenums">&lt;mapping from=&quot;property&quot; to=&quot;target.property&quot; andDo=&quot;target.id = createId()&quot; /&gt;</pre></div>
		</div>
		
		</li>
		</ul>
		
		
		</div>


		
		<div class="section"><h2>Scripting<a name="Scripting"></a></h2>
			<p>Javascript is used as internal scripting language. It is used in both java- and xml-mappings to evaluate selectors or convert values.
			During the evaluation of script, there are some global objects registered:
				</p><ul>
					<li><b>log: </b>A log that can be used to output debug, info, error, warning or trace messages.</li>
					<li><b>$: </b>An object that enables access to <b>environment variables</b>, e.g.:  <tt>$[&quot;MyVariable&quot;]</tt>.</li>
					<li><b>source/target: </b> The current source or target object. (depending on the context, <tt>source</tt> or <tt>target</tt> may not be available, e.g. there is no <tt>target</tt> available in the factoryExpr-exrpession)</li>
					<li><b>parent: </b> This object is available in sub-mappers and enables access to the parent-context, e.g. to hand over variables betwees submappers or access the parent-target-object with <tt>parent.target</tt>.</li>
				</ul>
			
		</div>

	


                  </div>
            </div>
          </div>

    <hr/>

    <footer>
            <div class="container-fluid">
              <div class="row span12">Copyright &copy;                   2014.
          All Rights Reserved.      
                    
      </div>

                          
        
                </div>
    </footer>
  </body>
</html>
